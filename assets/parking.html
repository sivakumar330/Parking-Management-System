<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parking Management System</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="css/park.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="#">
          <i class="fas fa-parking"></i> Parking Management System
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link active" href="#dashboard"
                ><i class="fas fa-tachometer-alt"></i> Dashboard</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#entry"
                ><i class="fas fa-sign-in-alt"></i> Vehicle Entry</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#exit"
                ><i class="fas fa-sign-out-alt"></i> Vehicle Exit</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#history"
                ><i class="fas fa-history"></i> History</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#reports"
                ><i class="fas fa-chart-bar"></i> Reports</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#configuration"
                ><i class="fas fa-cog"></i> Configuration</a
              >
            </li>
            <li class="nav-item">
              <button
                class="btn btn-outline-warning btn-sm mt-1 ms-2"
                data-bs-toggle="modal"
                data-bs-target="#resetModal"
              >
                <i class="fas fa-sync-alt"></i> Reset System
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Reset Confirmation Modal -->
    <div
      class="modal fade"
      id="resetModal"
      tabindex="-1"
      aria-labelledby="resetModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-warning">
            <h5 class="modal-title" id="resetModalLabel">
              Reset System Confirmation
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to reset the entire system?</p>
            <div class="alert alert-danger">
              <i class="fas fa-exclamation-triangle"></i> This action will:
              <ul class="mb-0 mt-2">
                <li>Clear all vehicle records</li>
                <li>Reset all parking slots to available</li>
                <li>Set today's revenue to zero</li>
                <li>Delete all transaction history</li>
              </ul>
            </div>
            <p>This action cannot be undone.</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-danger" id="confirmReset">
              Reset System
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
      <!-- Dashboard Section -->
      <section id="dashboard">
        <h2 class="mb-4">Dashboard</h2>
        <div class="row">
          <div class="col-md-3">
            <div class="card text-white bg-primary dashboard-stat">
              <div class="card-body">
                <i class="fas fa-car"></i>
                <h5>Total Vehicles Parked</h5>
                <div class="stat-number" id="total-vehicles">0</div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-white bg-success dashboard-stat">
              <div class="card-body">
                <i class="fas fa-parking"></i>
                <h5>Available Slots</h5>
                <div class="stat-number" id="available-slots">0</div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-white bg-warning dashboard-stat">
              <div class="card-body">
                <i class="fas fa-money-bill-wave"></i>
                <h5>Today's Revenue</h5>
                <div class="stat-number">
                  ₹<span id="today-revenue">0</span>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-white bg-info dashboard-stat">
              <div class="card-body">
                <i class="fas fa-clock"></i>
                <h5>Avg. Parking Time</h5>
                <div class="stat-number" id="avg-time">0h</div>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Currently Parked Vehicles</h5>
              </div>
              <div class="card-body">
                <div class="vehicle-list" id="current-vehicles">
                  <p class="text-center">Loading vehicles...</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Slot Availability</h5>
              </div>
              <div class="card-body">
                <h6>2-Wheeler Slots</h6>
                <div class="progress mb-3">
                  <div
                    id="twoW-progress"
                    class="progress-bar bg-success"
                    role="progressbar"
                    style="width: 100%"
                  >
                    10/10 Available
                  </div>
                </div>

                <h6>4-Wheeler Slots</h6>
                <div class="progress">
                  <div
                    id="fourW-progress"
                    class="progress-bar bg-success"
                    role="progressbar"
                    style="width: 100%"
                  >
                    5/5 Available
                  </div>
                </div>

                <div class="parking-visualization mt-4">
                  <h6 class="text-center mb-3">Parking Lot Visualization</h6>
                  <div id="parking-lot">
                    <!-- Parking slots will be dynamically generated here -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Vehicle Entry Section -->
      <section id="entry" class="mt-5">
        <h2 class="mb-4">Vehicle Entry</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="parking-form">
              <form id="entry-form">
                <div class="mb-3">
                  <label for="vehicleNumber" class="form-label"
                    >Vehicle Number</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="vehicleNumber"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="vehicleType" class="form-label"
                    >Vehicle Type</label
                  >
                  <select class="form-select" id="vehicleType" required>
                    <option value="">Select Type</option>
                    <option value="2W">2-Wheeler</option>
                    <option value="4W">4-Wheeler</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="ownerName" class="form-label">Owner Name</label>
                  <input
                    type="text"
                    class="form-control"
                    id="ownerName"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="ownerContact" class="form-label"
                    >Owner Contact (Optional)</label
                  >
                  <input type="text" class="form-control" id="ownerContact" />
                </div>
                <button type="submit" class="btn btn-primary" id="entry-submit">
                  <span id="entry-btn-text">Generate Ticket</span>
                  <span id="entry-loading" class="loading ms-2 d-none"></span>
                </button>
              </form>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">Entry Ticket</h5>
              </div>
              <div class="card-body" id="ticket-preview">
                <p class="text-center">Form data will appear here</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Vehicle Exit Section -->
      <section id="exit" class="mt-5">
        <h2 class="mb-4">Vehicle Exit</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="parking-form">
              <form id="exit-form">
                <div class="mb-3">
                  <label for="exitVehicleNumber" class="form-label"
                    >Vehicle Number</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="exitVehicleNumber"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary" id="exit-submit">
                  <span id="exit-btn-text">Process Exit</span>
                  <span id="exit-loading" class="loading ms-2 d-none"></span>
                </button>
              </form>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-info text-white">
                <h5 class="mb-0">Exit Receipt</h5>
              </div>
              <div class="card-body" id="exit-receipt">
                <p class="text-center">Exit details will appear here</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- History Section -->
      <section id="history" class="mt-5">
        <h2 class="mb-4">Parking History</h2>

        <div class="filter-section">
          <div class="row">
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filterDate" class="form-label">Date</label>
                <input type="date" class="form-control" id="filterDate" />
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filterVehicleType" class="form-label"
                  >Vehicle Type</label
                >
                <select class="form-select" id="filterVehicleType">
                  <option value="">All Types</option>
                  <option value="2W">2-Wheeler</option>
                  <option value="4W">4-Wheeler</option>
                </select>
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label for="filterVehicleNumber" class="form-label"
                  >Vehicle Number</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="filterVehicleNumber"
                  placeholder="Search vehicle..."
                />
              </div>
            </div>
            <div class="col-md-3">
              <div class="mb-3">
                <label class="form-label">&nbsp;</label>
                <div class="d-grid gap-2">
                  <button class="btn btn-primary" id="applyFilters">
                    <i class="fas fa-filter"></i> Apply Filters
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div
            class="card-header bg-dark text-white d-flex justify-content-between align-items-center"
          >
            <h5 class="mb-0">Parking Records</h5>
            <div>
              <button class="btn btn-sm btn-success export-btn" id="exportCSV">
                <i class="fas fa-file-csv"></i> Export CSV
              </button>
              <button class="btn btn-sm btn-danger export-btn" id="exportPDF">
                <i class="fas fa-file-pdf"></i> Export PDF
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table
                class="table table-striped table-hover history-table"
                id="historyTable"
              >
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Vehicle Number</th>
                    <th>Type</th>
                    <th>Owner</th>
                    <th>Entry Time</th>
                    <th>Exit Time</th>
                    <th>Duration</th>
                    <th>Amount</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="historyTableBody">
                  <tr>
                    <td colspan="9" class="text-center">Loading history...</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <nav aria-label="History pagination">
              <ul
                class="pagination justify-content-center"
                id="historyPagination"
              >
                <li class="page-item disabled">
                  <a class="page-link" href="#" tabindex="-1">Previous</a>
                </li>
                <li class="page-item active">
                  <a class="page-link" href="#">1</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="#">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </section>

      <!-- Configuration Section -->
      <section id="configuration" class="mt-5">
        <h2 class="mb-4">System Configuration</h2>

        <div class="card">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Parking Slot Configuration</h5>
          </div>
          <div class="card-body">
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">Add New Slots</h6>
                  </div>
                  <div class="card-body">
                    <form id="add-slot-form">
                      <div class="mb-3">
                        <label for="slotType" class="form-label"
                          >Slot Type</label
                        >
                        <select class="form-select" id="slotType" required>
                          <option value="">Select Type</option>
                          <option value="2W">2-Wheeler</option>
                          <option value="4W">4-Wheeler</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="slotCount" class="form-label"
                          >Number of Slots to Add</label
                        >
                        <input
                          type="number"
                          class="form-control"
                          id="slotCount"
                          min="1"
                          max="20"
                          value="1"
                          required
                        />
                      </div>
                      <button type="submit" class="btn btn-success">
                        <i class="fas fa-plus"></i> Add Slots
                      </button>
                    </form>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="card">
                  <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">Current Configuration</h6>
                  </div>
                  <div class="card-body">
                    <div class="d-flex justify-content-between mb-3">
                      <span>2-Wheeler Slots:</span>
                      <span id="config-twoW-count">10</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                      <span>4-Wheeler Slots:</span>
                      <span id="config-fourW-count">5</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                      <span>Total Slots:</span>
                      <span id="config-total-count">15</span>
                    </div>
                    <div class="d-flex justify-content-between">
                      <span>Available Slots:</span>
                      <span id="config-available-count">15</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <h6 class="mb-3">Manage Existing Slots</h6>
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Slot Number</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Vehicle</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="slot-management-body">
                  <!-- Slot data will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card mt-4">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Pricing Configuration</h5>
          </div>
          <div class="card-body">
            <form id="pricing-form">
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="twoWheelerRate" class="form-label"
                      >2-Wheeler Rate (₹ per hour)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="twoWheelerRate"
                      min="10"
                      max="100"
                      value="20"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="fourWheelerRate" class="form-label"
                      >4-Wheeler Rate (₹ per hour)</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="fourWheelerRate"
                      min="20"
                      max="200"
                      value="40"
                      required
                    />
                  </div>
                </div>
              </div>
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Save Pricing
              </button>
            </form>
          </div>
        </div>
      </section>

      <!-- Reports Section -->
      <section id="reports" class="mt-5 mb-5">
        <h2 class="mb-4">Reports & Analytics</h2>
        <div class="row">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Daily Report</h5>
              </div>
              <div class="card-body">
                <canvas id="dailyChart" height="250"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card">
              <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Revenue by Vehicle Type</h5>
              </div>
              <div class="card-body">
                <canvas id="revenueChart" height="250"></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="row mt-4">
          <div class="col-md-12">
            <div class="card">
              <div
                class="card-header bg-dark text-white d-flex justify-content-between align-items-center"
              >
                <h5 class="mb-0">Monthly Revenue Report</h5>
                <button class="btn btn-sm btn-success" id="exportRevenueReport">
                  <i class="fas fa-download"></i> Export Report
                </button>
              </div>
              <div class="card-body">
                <canvas id="monthlyRevenueChart" height="100"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <!-- History Detail Modal -->
    <div
      class="modal fade"
      id="historyDetailModal"
      tabindex="-1"
      aria-labelledby="historyDetailModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white">
            <h5 class="modal-title" id="historyDetailModalLabel">
              Parking Record Details
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body" id="historyDetailContent">
            <!-- Details will be loaded here -->
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              id="printHistoryDetails"
            >
              <i class="fas fa-print"></i> Print
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
      <p class="mb-0">
        Parking Management System &copy; 2023. All rights reserved.
      </p>
    </footer>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <!-- Application Script -->
    <script src="js/park.js"></script>
  </body>
</html>
